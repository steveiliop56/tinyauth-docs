import{j as i}from"./index-BDrdAJGi.js";let l={title:"Advanced",description:"Guides and tips for advanced setups."},d=[{href:"/docs/guides/access-controls#modifying-the-tinyauth-container"},{href:"https://github.com/steveiliop56/tinyauth/issues/35"},{href:"https://github.com/liveder"},{href:"https://github.com/steveiliop56/tinyauth/issues/134#issuecomment-2848793841"},{href:"https://github.com/eliasbenb"}],o={contents:[{heading:void 0,content:"Below, you can find some guides for advanced setups."},{heading:"authenticating-to-apps-with-basic-auth",content:"Some apps already offer authentication methods like basic auth (e.g., browser pop-ups). This can be inconvenient as it requires logging in to both Tinyauth and the protected app. Tinyauth supports authenticating to apps automatically by adding basic auth labels to the protected app."},{heading:"authenticating-to-apps-with-basic-auth",content:"For Traefik, add the following label to the Tinyauth container:"},{heading:"authenticating-to-apps-with-basic-auth",content:"Ensure Tinyauth can read Docker labels by connecting the Docker socket to the container."},{heading:"authenticating-to-apps-with-basic-auth",content:"Add the Tinyauth labels to the service:"},{heading:"authenticating-to-apps-with-basic-auth",content:"type: tip"},{heading:"authenticating-to-apps-with-basic-auth",content:`Use the tinyauth.apps.whoami.response.basic.passwordfile label instead of
the plain one to keep the password secure in a secret file. Ensure the
secret file is added as a volume to Tinyauth.`},{heading:"authenticating-to-apps-with-basic-auth",content:"Restart the app. Logging in to Tinyauth will automatically log in to the protected app using basic auth."},{heading:"host-network-and-traefik",content:"When using network_mode: host in Docker alongside Traefik, the redirect_uri in Tinyauth defaults to the app URL instead of the actual redirect URI. This occurs because Traefik does not respect the X-Forwarded-Host header from NAT IP addresses like Docker's internal ones. This can be resolved by:"},{heading:"host-network-and-traefik",content:"Using the following Traefik configuration:"},{heading:"host-network-and-traefik",content:"Or by using CLI arguments:"},{heading:"host-network-and-traefik",content:"See issue #35 by Aleksey."},{heading:"tinyauth-behind-a-proxy",content:"In some environments, Tinyauth may need to operate behind another proxy. For example, Tinyauth might be hosted at tinyauth.mydomain.com while its middleware is used by another proxy at http://tinyauth.mydomain.com/api/auth/traefik."},{heading:"tinyauth-behind-a-proxy",content:"In such cases, Traefik does not respect the X-Forwarded-* headers, causing the redirect_uri in Tinyauth to point to Tinyauth's domain instead of the app's domain. To fix this, configure Traefik to trust headers from the upstream proxy. For example:"},{heading:"tinyauth-behind-a-proxy",content:"Configure Proxy 2 to trust headers from Proxy 1:"},{heading:"tinyauth-behind-a-proxy",content:"Alternatively, use CLI options:"},{heading:"tinyauth-behind-a-proxy",content:"See issue #134 by @eliasbenb."}],headings:[{id:"authenticating-to-apps-with-basic-auth",content:"Authenticating to Apps with Basic Auth"},{id:"host-network-and-traefik",content:"Host Network and Traefik"},{id:"tinyauth-behind-a-proxy",content:"Tinyauth Behind a Proxy"}]};const c=[{depth:2,url:"#authenticating-to-apps-with-basic-auth",title:i.jsx(i.Fragment,{children:"Authenticating to Apps with Basic Auth"})},{depth:2,url:"#host-network-and-traefik",title:i.jsx(i.Fragment,{children:"Host Network and Traefik"})},{depth:2,url:"#tinyauth-behind-a-proxy",title:i.jsx(i.Fragment,{children:"Tinyauth Behind a Proxy"})}];function a(s){const e={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",ul:"ul",...s.components},{Callout:t,Mermaid:n}=e;return t||h("Callout"),n||h("Mermaid"),i.jsxs(i.Fragment,{children:[i.jsx(e.p,{children:"Below, you can find some guides for advanced setups."}),`
`,i.jsx(e.h2,{id:"authenticating-to-apps-with-basic-auth",children:"Authenticating to Apps with Basic Auth"}),`
`,i.jsx(e.p,{children:"Some apps already offer authentication methods like basic auth (e.g., browser pop-ups). This can be inconvenient as it requires logging in to both Tinyauth and the protected app. Tinyauth supports authenticating to apps automatically by adding basic auth labels to the protected app."}),`
`,i.jsxs(e.ol,{children:[`
`,i.jsxs(e.li,{children:[`
`,i.jsx(e.p,{children:"For Traefik, add the following label to the Tinyauth container:"}),`
`,i.jsx(i.Fragment,{children:i.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabIndex:"0",icon:'<svg viewBox="0 0 24 24"><path d="M 6,1 C 4.354992,1 3,2.354992 3,4 v 16 c 0,1.645008 1.354992,3 3,3 h 12 c 1.645008,0 3,-1.354992 3,-3 V 8 7 A 1.0001,1.0001 0 0 0 20.707031,6.2929687 l -5,-5 A 1.0001,1.0001 0 0 0 15,1 h -1 z m 0,2 h 7 v 3 c 0,1.645008 1.354992,3 3,3 h 3 v 11 c 0,0.564129 -0.435871,1 -1,1 H 6 C 5.4358712,21 5,20.564129 5,20 V 4 C 5,3.4358712 5.4358712,3 6,3 Z M 15,3.4140625 18.585937,7 H 16 C 15.435871,7 15,6.5641288 15,6 Z" fill="currentColor" /></svg>',children:i.jsx(e.code,{children:i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"traefik.http.middlewares.tinyauth.forwardauth.authResponseHeaders"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"authorization"})]})})})}),`
`]}),`
`,i.jsxs(e.li,{children:[`
`,i.jsxs(e.p,{children:["Ensure Tinyauth can read Docker labels by ",i.jsx(e.a,{href:"/docs/guides/access-controls#modifying-the-tinyauth-container",children:"connecting the Docker socket to the container"}),"."]}),`
`]}),`
`,i.jsxs(e.li,{children:[`
`,i.jsx(e.p,{children:"Add the Tinyauth labels to the service:"}),`
`,i.jsx(i.Fragment,{children:i.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabIndex:"0",icon:'<svg viewBox="0 0 24 24"><path d="M 6,1 C 4.354992,1 3,2.354992 3,4 v 16 c 0,1.645008 1.354992,3 3,3 h 12 c 1.645008,0 3,-1.354992 3,-3 V 8 7 A 1.0001,1.0001 0 0 0 20.707031,6.2929687 l -5,-5 A 1.0001,1.0001 0 0 0 15,1 h -1 z m 0,2 h 7 v 3 c 0,1.645008 1.354992,3 3,3 h 3 v 11 c 0,0.564129 -0.435871,1 -1,1 H 6 C 5.4358712,21 5,20.564129 5,20 V 4 C 5,3.4358712 5.4358712,3 6,3 Z M 15,3.4140625 18.585937,7 H 16 C 15.435871,7 15,6.5641288 15,6 Z" fill="currentColor" /></svg>',children:i.jsxs(e.code,{children:[i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"services"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  whoami"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    labels"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"      tinyauth.apps.whoami.response.basic.username"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"username"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"      tinyauth.apps.whoami.response.basic.password"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"password"})]})]})})}),`
`,i.jsx(t,{type:"tip",children:i.jsxs(e.p,{children:["Use the ",i.jsx(e.code,{children:"tinyauth.apps.whoami.response.basic.passwordfile"}),` label instead of
the plain one to keep the password secure in a secret file. Ensure the
secret file is added as a volume to Tinyauth.`]})}),`
`]}),`
`,i.jsxs(e.li,{children:[`
`,i.jsx(e.p,{children:"Restart the app. Logging in to Tinyauth will automatically log in to the protected app using basic auth."}),`
`]}),`
`]}),`
`,i.jsx(e.h2,{id:"host-network-and-traefik",children:"Host Network and Traefik"}),`
`,i.jsxs(e.p,{children:["When using ",i.jsx(e.code,{children:"network_mode: host"})," in Docker alongside Traefik, the ",i.jsx(e.code,{children:"redirect_uri"})," in Tinyauth defaults to the app URL instead of the actual redirect URI. This occurs because Traefik does not respect the ",i.jsx(e.code,{children:"X-Forwarded-Host"})," header from NAT IP addresses like Docker's internal ones. This can be resolved by:"]}),`
`,i.jsxs(e.ul,{children:[`
`,i.jsx(e.li,{children:"Using the following Traefik configuration:"}),`
`]}),`
`,i.jsx(i.Fragment,{children:i.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabIndex:"0",icon:'<svg viewBox="0 0 24 24"><path d="M 6,1 C 4.354992,1 3,2.354992 3,4 v 16 c 0,1.645008 1.354992,3 3,3 h 12 c 1.645008,0 3,-1.354992 3,-3 V 8 7 A 1.0001,1.0001 0 0 0 20.707031,6.2929687 l -5,-5 A 1.0001,1.0001 0 0 0 15,1 h -1 z m 0,2 h 7 v 3 c 0,1.645008 1.354992,3 3,3 h 3 v 11 c 0,0.564129 -0.435871,1 -1,1 H 6 C 5.4358712,21 5,20.564129 5,20 V 4 C 5,3.4358712 5.4358712,3 6,3 Z M 15,3.4140625 18.585937,7 H 16 C 15.435871,7 15,6.5641288 15,6 Z" fill="currentColor" /></svg>',children:i.jsxs(e.code,{children:[i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"entryPoints"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  web"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    forwardedHeaders"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"      trustedIPs"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"        - "}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"127.0.0.1/32"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"        - "}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"172.16.0.0/12"})]})]})})}),`
`,i.jsxs(e.ul,{children:[`
`,i.jsx(e.li,{children:"Or by using CLI arguments:"}),`
`]}),`
`,i.jsx(i.Fragment,{children:i.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabIndex:"0",icon:'<svg viewBox="0 0 24 24"><path d="m 4,4 a 1,1 0 0 0 -0.7070312,0.2929687 1,1 0 0 0 0,1.4140625 L 8.5859375,11 3.2929688,16.292969 a 1,1 0 0 0 0,1.414062 1,1 0 0 0 1.4140624,0 l 5.9999998,-6 a 1.0001,1.0001 0 0 0 0,-1.414062 L 4.7070312,4.2929687 A 1,1 0 0 0 4,4 Z m 8,14 a 1,1 0 0 0 -1,1 1,1 0 0 0 1,1 h 8 a 1,1 0 0 0 1,-1 1,1 0 0 0 -1,-1 z" fill="currentColor" /></svg>',children:i.jsx(e.code,{children:i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"--entryPoints.web.forwardedHeaders.trustedIPs"}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"=127.0.0.1/32,172.16.0.0/12"})]})})})}),`
`,i.jsx(e.p,{children:i.jsxs(e.em,{children:["See issue ",i.jsx(e.a,{href:"https://github.com/steveiliop56/tinyauth/issues/35",children:"#35"})," by ",i.jsx(e.a,{href:"https://github.com/liveder",children:"Aleksey"}),"."]})}),`
`,i.jsx(e.h2,{id:"tinyauth-behind-a-proxy",children:"Tinyauth Behind a Proxy"}),`
`,i.jsxs(e.p,{children:["In some environments, Tinyauth may need to operate behind another proxy. For example, Tinyauth might be hosted at ",i.jsx(e.code,{children:"tinyauth.mydomain.com"})," while its middleware is used by another proxy at ",i.jsx(e.code,{children:"http://tinyauth.mydomain.com/api/auth/traefik"}),"."]}),`
`,i.jsxs(e.p,{children:["In such cases, Traefik does not respect the ",i.jsx(e.code,{children:"X-Forwarded-*"})," headers, causing the ",i.jsx(e.code,{children:"redirect_uri"})," in Tinyauth to point to Tinyauth's domain instead of the app's domain. To fix this, configure Traefik to trust headers from the upstream proxy. For example:"]}),`
`,i.jsx(n,{chart:`flowchart LR
  user["User"] --> tinyauthExposed["tinyauth.mydomain.com"]
  tinyauthExposed --> proxy1["Proxy 1 (10.0.0.2)"]
  proxy1 --> proxy2["Proxy 2 (10.0.0.3)"]
  proxy2 --> tinyauth["Tinyauth"]`}),`
`,i.jsx(e.p,{children:"Configure Proxy 2 to trust headers from Proxy 1:"}),`
`,i.jsx(i.Fragment,{children:i.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabIndex:"0",icon:'<svg viewBox="0 0 24 24"><path d="M 6,1 C 4.354992,1 3,2.354992 3,4 v 16 c 0,1.645008 1.354992,3 3,3 h 12 c 1.645008,0 3,-1.354992 3,-3 V 8 7 A 1.0001,1.0001 0 0 0 20.707031,6.2929687 l -5,-5 A 1.0001,1.0001 0 0 0 15,1 h -1 z m 0,2 h 7 v 3 c 0,1.645008 1.354992,3 3,3 h 3 v 11 c 0,0.564129 -0.435871,1 -1,1 H 6 C 5.4358712,21 5,20.564129 5,20 V 4 C 5,3.4358712 5.4358712,3 6,3 Z M 15,3.4140625 18.585937,7 H 16 C 15.435871,7 15,6.5641288 15,6 Z" fill="currentColor" /></svg>',children:i.jsxs(e.code,{children:[i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"entryPoints"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  web"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    forwardedHeaders"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"      trustedIPs"}),i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),`
`,i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"        - "}),i.jsx(e.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:"10.0.0.2"})]})]})})}),`
`,i.jsx(e.p,{children:"Alternatively, use CLI options:"}),`
`,i.jsx(i.Fragment,{children:i.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark",style:{"--shiki-light":"#24292e","--shiki-dark":"#e1e4e8","--shiki-light-bg":"#fff","--shiki-dark-bg":"#24292e"},tabIndex:"0",icon:'<svg viewBox="0 0 24 24"><path d="m 4,4 a 1,1 0 0 0 -0.7070312,0.2929687 1,1 0 0 0 0,1.4140625 L 8.5859375,11 3.2929688,16.292969 a 1,1 0 0 0 0,1.414062 1,1 0 0 0 1.4140624,0 l 5.9999998,-6 a 1.0001,1.0001 0 0 0 0,-1.414062 L 4.7070312,4.2929687 A 1,1 0 0 0 4,4 Z m 8,14 a 1,1 0 0 0 -1,1 1,1 0 0 0 1,1 h 8 a 1,1 0 0 0 1,-1 1,1 0 0 0 -1,-1 z" fill="currentColor" /></svg>',children:i.jsx(e.code,{children:i.jsxs(e.span,{className:"line",children:[i.jsx(e.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"--entryPoints.web.forwardedHeaders.trustedIPs"}),i.jsx(e.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"=10.0.0.2"})]})})})}),`
`,i.jsx(e.p,{children:i.jsxs(e.em,{children:["See issue ",i.jsx(e.a,{href:"https://github.com/steveiliop56/tinyauth/issues/134#issuecomment-2848793841",children:"#134"})," by ",i.jsx(e.a,{href:"https://github.com/eliasbenb",children:"@eliasbenb"}),"."]})})]})}function p(s={}){const{wrapper:e}=s.components||{};return e?i.jsx(e,{...s,children:i.jsx(a,{...s})}):a(s)}function h(s,e){throw new Error("Expected component `"+s+"` to be defined: you likely forgot to import, pass, or provide it.")}export{p as default,d as extractedReferences,l as frontmatter,o as structuredData,c as toc};
